<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Content Management | SEDEN ASSOCIATES</title>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    
    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <!-- CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Dropzone CSS -->
    <link rel="stylesheet" href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css">
    
    <!-- Quill Rich Text Editor CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        secondary: {
                            50: '#fff7ed',
                            100: '#ffedd5',
                            200: '#fed7aa',
                            300: '#fdba74',
                            400: '#fb923c',
                            500: '#f97316',
                            600: '#ea580c',
                            700: '#c2410c',
                            800: '#9a3412',
                            900: '#7c2d12',
                        },
                        dark: {
                            900: '#0f172a',
                            800: '#1e293b',
                            700: '#334155',
                            600: '#475569',
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Inline critical CSS -->
    <style>
        /* [Previous CSS styles remain exactly the same] */
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- [Previous HTML structure remains exactly the same until the script section] -->

    <!-- Dropzone JS -->
    <script src="https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"></script>
    <!-- Quill Rich Text Editor JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <script>
        // ========== CONFIGURATION ==========
        const BACKEND_URL = 'https://your-flask-backend.herokuapp.com'; // UPDATE THIS WITH YOUR FLASK BACKEND URL
        
        // ========== GLOBAL VARIABLES ==========
        let uploadedFileUrl = '';
        let uploadedVideoUrl = '';
        let uploadedThumbnailUrl = '';
        let uploadedGalleryImageUrls = [];
        let uploadedDocumentUrl = '';
        let quillEditor = null;

        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Quill editor
            quillEditor = new Quill('#post-content-editor', {
                theme: 'snow',
                placeholder: 'Write your post content here...',
                modules: {
                    toolbar: [
                        [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        [{ 'script': 'sub'}, { 'script': 'super' }],
                        [{ 'indent': '-1'}, { 'indent': '+1' }],
                        [{ 'direction': 'rtl' }],
                        [{ 'color': [] }, { 'background': [] }],
                        [{ 'font': [] }],
                        [{ 'align': [] }],
                        ['link', 'image', 'video'],
                        ['clean']
                    ]
                }
            });

            // ========== FILE UPLOAD HANDLERS ==========
            
            // Featured Image Dropzone (for posts)
            const featuredImageDropzone = new Dropzone("#featured-image-dropzone", {
                url: `${BACKEND_URL}/upload`,
                maxFiles: 1,
                acceptedFiles: "image/*,application/pdf,video/*,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation",
                addRemoveLinks: true,
                dictDefaultMessage: '<div class="text-center py-8"><i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i><p class="text-sm text-gray-600">Drag & drop your file here or click to browse</p><p class="text-xs text-gray-500 mt-1">Supported: Images, PDFs, Videos, Documents (Doc, Xls, Ppt)</p></div>',
            });

            featuredImageDropzone.on("success", function(file, response) {
                if (response.file_url) {
                    uploadedFileUrl = response.file_url;
                    updateUploadDisplay('uploaded-file-url-display', response.file_url, 'clear-uploaded-file');
                    this.removeAllFiles();
                }
            });

            // Video Dropzone
            const videoDropzone = new Dropzone("#video-dropzone", {
                url: `${BACKEND_URL}/upload`,
                maxFiles: 1,
                acceptedFiles: "video/*",
                addRemoveLinks: true,
                dictDefaultMessage: '<div class="text-center py-8"><i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i><p class="text-sm text-gray-600">Drag & drop your video file here or click to browse</p><p class="text-xs text-gray-500 mt-1">Supported formats: MP4, WebM, Ogg</p></div>',
            });

            videoDropzone.on("success", function(file, response) {
                if (response.file_url) {
                    uploadedVideoUrl = response.file_url;
                    updateUploadDisplay('uploaded-video-url-display', response.file_url, 'clear-uploaded-video');
                    this.removeAllFiles();
                }
            });

            // Video Thumbnail Dropzone
            const videoThumbnailDropzone = new Dropzone("#video-thumbnail-dropzone", {
                url: `${BACKEND_URL}/upload`,
                maxFiles: 1,
                acceptedFiles: "image/*",
                addRemoveLinks: true,
                dictDefaultMessage: '<div class="text-center py-8"><i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i><p class="text-sm text-gray-600">Drag & drop your thumbnail image here or click to browse</p><p class="text-xs text-gray-500 mt-1">Recommended size: 1280x720px</p></div>',
            });

            videoThumbnailDropzone.on("success", function(file, response) {
                if (response.file_url) {
                    uploadedThumbnailUrl = response.file_url;
                    updateUploadDisplay('uploaded-thumbnail-url-display', response.file_url, 'clear-uploaded-thumbnail');
                    this.removeAllFiles();
                }
            });

            // Image Gallery Dropzone
            const imageGalleryDropzone = new Dropzone("#image-gallery-dropzone", {
                url: `${BACKEND_URL}/upload`,
                acceptedFiles: "image/*",
                addRemoveLinks: true,
                dictDefaultMessage: '<div class="text-center py-8"><i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i><p class="text-sm text-gray-600">Drag & drop images here or click to browse</p><p class="text-xs text-gray-500 mt-1">Multiple images allowed</p></div>',
            });

            imageGalleryDropzone.on("success", function(file, response) {
                if (response.file_url) {
                    uploadedGalleryImageUrls.push(response.file_url);
                    addGalleryImagePreview(response.file_url);
                }
            });

            // Document Dropzone
            const documentDropzone = new Dropzone("#document-dropzone", {
                url: `${BACKEND_URL}/upload`,
                maxFiles: 1,
                acceptedFiles: "application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation",
                addRemoveLinks: true,
                dictDefaultMessage: '<div class="text-center py-8"><i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i><p class="text-sm text-gray-600">Drag & drop your document file here or click to browse</p><p class="text-xs text-gray-500 mt-1">Supported formats: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX</p></div>',
            });

            documentDropzone.on("success", function(file, response) {
                if (response.file_url) {
                    uploadedDocumentUrl = response.file_url;
                    updateUploadDisplay('uploaded-document-url-display', response.file_url, 'clear-uploaded-document');
                    this.removeAllFiles();
                }
            });

            // ========== FORM SUBMISSION HANDLERS ==========

            // Post Form Submission
            document.getElementById('post-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                toggleLoading('publish-post-button', 'post-submit-spinner', 'post-submit-text', true);

                const postData = {
                    title: document.getElementById('post-title').value,
                    excerpt: document.getElementById('post-excerpt').value,
                    content: quillEditor.root.innerHTML,
                    category: document.getElementById('post-category').value,
                    image_url: uploadedFileUrl,
                    status: document.getElementById('post-status').value,
                    publish_date: document.getElementById('post-schedule-date').value || new Date().toISOString()
                };

                try {
                    const response = await fetch(`${BACKEND_URL}/api/posts`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(postData)
                    });
                    
                    const result = await response.json();
                    if (response.ok) {
                        showSuccessModal('Post Published!', 'Your post has been successfully published.');
                        resetPostForm();
                    } else {
                        showErrorModal('Error!', result.message || 'Failed to publish post.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showErrorModal('Error!', 'An unexpected error occurred. Please try again.');
                } finally {
                    toggleLoading('publish-post-button', 'post-submit-spinner', 'post-submit-text', false);
                }
            });

            // Video Form Submission
            document.getElementById('video-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                toggleLoading('upload-video-button', 'video-submit-spinner', 'video-submit-text', true);

                const videoData = {
                    title: document.getElementById('video-title').value,
                    excerpt: document.getElementById('video-description').value,
                    content: document.getElementById('video-description').value,
                    category: document.getElementById('video-category').value,
                    image_url: uploadedVideoUrl,
                    thumbnail_url: uploadedThumbnailUrl,
                    status: document.getElementById('video-status').value,
                    publish_date: new Date().toISOString()
                };

                try {
                    const response = await fetch(`${BACKEND_URL}/api/posts`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(videoData)
                    });
                    
                    const result = await response.json();
                    if (response.ok) {
                        showSuccessModal('Video Uploaded!', 'Your video has been successfully uploaded.');
                        resetVideoForm();
                    } else {
                        showErrorModal('Error!', result.message || 'Failed to upload video.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showErrorModal('Error!', 'An unexpected error occurred. Please try again.');
                } finally {
                    toggleLoading('upload-video-button', 'video-submit-spinner', 'video-submit-text', false);
                }
            });

            // Image Gallery Form Submission
            document.getElementById('image-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                toggleLoading('create-gallery-button', 'gallery-submit-spinner', 'gallery-submit-text', true);

                const galleryData = {
                    title: document.getElementById('image-gallery-title').value,
                    excerpt: document.getElementById('image-gallery-description').value,
                    content: JSON.stringify(uploadedGalleryImageUrls),
                    category: 'gallery',
                    image_url: uploadedGalleryImageUrls[0] || '',
                    status: 'published',
                    publish_date: new Date().toISOString()
                };

                try {
                    const response = await fetch(`${BACKEND_URL}/api/posts`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(galleryData)
                    });
                    
                    const result = await response.json();
                    if (response.ok) {
                        showSuccessModal('Gallery Created!', 'Your image gallery has been successfully created.');
                        resetGalleryForm();
                    } else {
                        showErrorModal('Error!', result.message || 'Failed to create gallery.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showErrorModal('Error!', 'An unexpected error occurred. Please try again.');
                } finally {
                    toggleLoading('create-gallery-button', 'gallery-submit-spinner', 'gallery-submit-text', false);
                }
            });

            // Document Form Submission
            document.getElementById('document-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                toggleLoading('upload-document-button', 'document-submit-spinner', 'document-submit-text', true);

                const documentData = {
                    title: document.getElementById('document-title').value,
                    excerpt: document.getElementById('document-description').value,
                    content: document.getElementById('document-description').value,
                    category: document.getElementById('document-category').value,
                    image_url: uploadedDocumentUrl,
                    status: document.getElementById('document-status').value,
                    publish_date: new Date().toISOString()
                };

                try {
                    const response = await fetch(`${BACKEND_URL}/api/posts`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(documentData)
                    });
                    
                    const result = await response.json();
                    if (response.ok) {
                        showSuccessModal('Document Uploaded!', 'Your document has been successfully uploaded.');
                        resetDocumentForm();
                    } else {
                        showErrorModal('Error!', result.message || 'Failed to upload document.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showErrorModal('Error!', 'An unexpected error occurred. Please try again.');
                } finally {
                    toggleLoading('upload-document-button', 'document-submit-spinner', 'document-submit-text', false);
                }
            });

            // ========== HELPER FUNCTIONS ==========

            function updateUploadDisplay(displayElementId, fileUrl, clearButtonId) {
                const displayElement = document.getElementById(displayElementId);
                const displayLink = displayElement.querySelector('a');
                
                displayLink.href = fileUrl;
                displayLink.textContent = fileUrl.split('/').pop();
                displayElement.classList.remove('hidden');

                document.getElementById(clearButtonId).onclick = () => {
                    displayElement.classList.add('hidden');
                    if (displayElementId === 'uploaded-file-url-display') uploadedFileUrl = '';
                    else if (displayElementId === 'uploaded-video-url-display') uploadedVideoUrl = '';
                    else if (displayElementId === 'uploaded-thumbnail-url-display') uploadedThumbnailUrl = '';
                    else if (displayElementId === 'uploaded-document-url-display') uploadedDocumentUrl = '';
                };
            }

            function addGalleryImagePreview(imageUrl) {
                const displayArea = document.getElementById('uploaded-gallery-images-display');
                const imgContainer = document.createElement('div');
                imgContainer.className = 'relative group';
                imgContainer.innerHTML = `
                    <img src="${imageUrl}" class="w-full h-24 object-cover rounded-md">
                    <button type="button" class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 text-xs opacity-0 group-hover:opacity-100 transition-opacity remove-gallery-image" data-url="${imageUrl}">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                displayArea.appendChild(imgContainer);

                imgContainer.querySelector('.remove-gallery-image').addEventListener('click', (e) => {
                    const urlToRemove = e.currentTarget.dataset.url;
                    uploadedGalleryImageUrls = uploadedGalleryImageUrls.filter(url => url !== urlToRemove);
                    e.currentTarget.closest('.group').remove();
                });
            }

            function toggleLoading(buttonId, spinnerId, textId, isLoading) {
                const button = document.getElementById(buttonId);
                const spinner = document.getElementById(spinnerId);
                const text = document.getElementById(textId);

                button.disabled = isLoading;
                spinner.classList.toggle('hidden', !isLoading);
                text.classList.toggle('hidden', isLoading);
            }

            function showSuccessModal(title, message) {
                showCustomModal('success', title, message);
            }

            function showErrorModal(title, message) {
                showCustomModal('error', title, message);
            }

            function showCustomModal(type, title, message) {
                const modal = document.getElementById('custom-modal');
                const icon = document.getElementById('modal-icon');
                const modalTitle = document.getElementById('modal-title');
                const modalMessage = document.getElementById('modal-message');

                icon.className = 'icon';
                icon.classList.add(type === 'success' ? 'success' : 'error');
                icon.innerHTML = type === 'success' ? '<i class="fas fa-check-circle"></i>' : '<i class="fas fa-times-circle"></i>';

                modalTitle.textContent = title;
                modalMessage.textContent = message;
                modal.classList.add('show');
            }

            function hideCustomModal() {
                document.getElementById('custom-modal').classList.remove('show');
            }

            function resetPostForm() {
                document.getElementById('post-form').reset();
                quillEditor.setContents([]);
                uploadedFileUrl = '';
                document.getElementById('uploaded-file-url-display').classList.add('hidden');
                document.getElementById('schedule-date-container').classList.add('hidden');
            }

            function resetVideoForm() {
                document.getElementById('video-form').reset();
                uploadedVideoUrl = '';
                uploadedThumbnailUrl = '';
                document.getElementById('uploaded-video-url-display').classList.add('hidden');
                document.getElementById('uploaded-thumbnail-url-display').classList.add('hidden');
            }

            function resetGalleryForm() {
                document.getElementById('image-form').reset();
                uploadedGalleryImageUrls = [];
                document.getElementById('uploaded-gallery-images-display').innerHTML = '';
            }

            function resetDocumentForm() {
                document.getElementById('document-form').reset();
                uploadedDocumentUrl = '';
                document.getElementById('uploaded-document-url-display').classList.add('hidden');
            }

            // ========== EVENT LISTENERS ==========

            // Tab switching
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.dataset.tab;
                    
                    // Update active tab button
                    document.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.remove('border-primary-500', 'text-primary-600');
                        btn.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    });
                    button.classList.add('border-primary-500', 'text-primary-600');
                    button.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    
                    // Update active tab content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${targetTab}-tab`).classList.add('active');
                });
            });

            // Post status change handler
            document.getElementById('post-status').addEventListener('change', function() {
                document.getElementById('schedule-date-container').classList.toggle('hidden', this.value !== 'scheduled');
            });

            // Mobile menu toggle
            document.getElementById('mobile-menu-button').addEventListener('click', () => {
                document.querySelector('.admin-sidebar').classList.toggle('open');
            });

            // Modal close button
            document.querySelector('.custom-modal-content .close-button').addEventListener('click', hideCustomModal);
            document.querySelector('.custom-modal-content button').addEventListener('click', hideCustomModal);
        });
    </script>
</body>
</html>
