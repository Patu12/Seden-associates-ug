<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Our Latest Posts | SEDEN ASSOCIATES</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
          colors: {
            primary: { 500: '#0ea5e9', 700: '#0369a1' },
            secondary: { 500: '#f97316', 700: '#ea580c' },
            dark: { 900: '#0f172a' }
          }
        }
      }
    }
  </script>
  <style>
    .post-media-container {
      width: 100%;
      height: 240px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f0f9ff;
    }
    .post-media-container img,
    .post-media-container video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .media-placeholder {
      font-size: 3rem;
      color: #7dd3fc;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">
  <header class="bg-white shadow py-4">
    <div class="max-w-7xl mx-auto px-4 flex justify-between items-center">
      <a href="/" class="text-xl font-bold text-primary-500">SEDEN ASSOCIATES</a>
      <nav>
        <a href="/" class="text-gray-600 hover:text-primary-500 px-4">Home</a>
        <a href="/posts" class="text-primary-500 font-bold px-4">Posts</a>
      </nav>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-10">
    <h1 class="text-3xl font-bold text-center mb-10">Our Latest Insights & News</h1>

    <div id="loading-message" class="text-center text-gray-600 mb-6 hidden">
      <i class="fas fa-spinner fa-spin mr-2"></i> Loading posts...
    </div>
    <div id="error-message" class="text-center text-red-600 hidden">
      <i class="fas fa-exclamation-triangle mr-2"></i> Failed to load posts. Please try again later.
    </div>
    <div id="no-posts-message" class="text-center text-gray-500 hidden">
      No posts available yet.
    </div>

    <div id="posts-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8"></div>
  </main>

  <footer class="bg-dark-900 text-white text-center py-6">
    <p>&copy; 2025 SEDEN ASSOCIATES. All rights reserved.</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const loadingMessage = document.getElementById('loading-message');
      const errorMessage = document.getElementById('error-message');
      const noPostsMessage = document.getElementById('no-posts-message');
      const postsContainer = document.getElementById('posts-container');

      loadingMessage.classList.remove('hidden');

      try {
        const response = await fetch('/public/posts');
        if (!response.ok) throw new Error(`HTTP error: ${response.status}`);

        const posts = await response.json();
        loadingMessage.classList.add('hidden');

        if (!posts.length) {
          noPostsMessage.classList.remove('hidden');
          return;
        }

        posts.forEach(post => {
          let media = '';
          const url = post.image_url;
          const ext = url.split('.').pop().toLowerCase();

          if (['mp4', 'webm', 'ogg'].includes(ext)) {
            media = `<video controls class="rounded-t-lg"><source src="${url}" type="video/${ext}">Video not supported.</video>`;
          } else if (ext === 'pdf') {
            media = `
              <div class="text-center p-4">
                <i class="fas fa-file-pdf text-red-500 text-5xl mb-2"></i>
                <p class="mb-2">PDF Available</p>
                <a href="${url}" target="_blank" class="bg-primary-500 hover:bg-primary-700 text-white py-1 px-3 rounded mb-2 inline-block">
                  <i class="fas fa-eye mr-1"></i> View
                </a>
                <a href="${url}" download class="bg-secondary-500 hover:bg-secondary-700 text-white py-1 px-3 rounded inline-block">
                  <i class="fas fa-download mr-1"></i> Download
                </a>
              </div>
            `;
          } else if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) {
            media = `<img src="${url}" alt="${post.title}" onerror="this.src='https://placehold.co/600x400?text=Image+Not+Found'" class="rounded-t-lg" />`;
          } else {
            media = `<div class="flex items-center justify-center text-gray-400 text-4xl h-full"><i class="fas fa-file"></i></div>`;
          }

          const html = `
            <div class="bg-white rounded-lg shadow hover:shadow-md overflow-hidden transition">
              <div class="post-media-container">${media}</div>
              <div class="p-4">
                <h2 class="text-xl font-semibold mb-1">${post.title}</h2>
                <p class="text-sm text-gray-600 mb-3">${post.excerpt}</p>
                <div class="text-xs text-gray-500 flex justify-between">
                  <span>${post.category}</span>
                  <span>${new Date(post.publish_date).toLocaleDateString()}</span>
                </div>
              </div>
            </div>
          `;

          postsContainer.insertAdjacentHTML('beforeend', html);
        });

      } catch (err) {
        console.error('Error loading posts:', err);
        loadingMessage.classList.add('hidden');
        errorMessage.classList.remove('hidden');
      }
    });
  </script>
</body>
</html>
